<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        </style>

        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #title {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            color: #000;
            font-family: Arial, sans-serif;
        }
        #title h1 {
            font-size: 18px;
            margin: 0;
            font-weight: bold;
        }
        #title p {
            font-size: 14px;
            margin: 5px 0 0 0;
        }
        #visit-counter {
            font-size: 14px;
            margin: 5px 0 0 0;
            color: #444;
        }
        </style>
        <title>Bản đồ ngập lụt các tỉnh miền Bắc do bão Yagi</title>
        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.min.js"></script>
    </head>
    <body>
        <div id="map">
            <div id="title">
                <h1>Bản đồ ngập lụt các tỉnh miền Bắc do bão Yagi, ngày 12/9/2024</h1>
                <p>Hoang Duc Vinh - VinhHRC@gmail.com - 0906 682 672</p>
                <p>Zalo 0906 682 672</p>
                <p id="visit-counter">Số lượt truy cập: <span id="counter">0</span></p>
            </div>
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="layers/MB1292024_final_1.js"></script>
        <script src="styles/MB1292024_final_1_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>
        <script>
            // Check if Firebase is loaded
            if (typeof firebase === 'undefined') {
                console.error('Firebase SDK not loaded');
                document.getElementById('counter').textContent = 'N/A';
            } else {
                try {
                    // Initialize Firebase
                    const firebaseConfig = {
                        apiKey: "YOUR_API_KEY",
                        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
                        databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
                        projectId: "YOUR_PROJECT_ID",
                        storageBucket: "YOUR_PROJECT fleece: keep original content unchanged unless explicitly asked to modify
ID.appspot.com",
                        messagingSenderId: "YOUR_SENDER_ID",
                        appId: "YOUR_APP_ID"
                    };

                    firebase.initializeApp(firebaseConfig);
                    const database = firebase.database();
                    const counterRef = database.ref('visits');

                    // Increment and display counter
                    counterRef.transaction((currentCount) => {
                        return (currentCount || 0) + 1;
                    }, (error, committed, snapshot) => {
                        if (error) {
                            console.error('Transaction failed:', error);
                            document.getElementById('counter').textContent = 'Error';
                        } else if (committed) {
                            document.getElementById('counter').textContent = snapshot.val();
                        }
                    });

                    // Update counter in real-time
                    counterRef.on('value', (snapshot) => {
                        document.getElementById('counter').textContent = snapshot.val() || 0;
                    }, (error) => {
                        console.error('Realtime update failed:', error);
                        document.getElementById('counter').textContent = 'Error';
                    });
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    document.getElementById('counter').textContent = 'N/A';
                }
            }
        </script>
    </body>
</html>
